name: Update BLS Data

# Schedule this action to run once a month, for example, on the 1st Friday 
# of the month at 10:00 AM UTC, which is typically when the main jobs report 
# (CES/CPS) is released, or shortly after.
on:
  schedule:
    # Runs at 10:00 AM UTC on the 1st Friday of every month
    # Note: BLS usually releases data on the first Friday of the month,
    # so check the release schedule and adjust the cron expression as needed.
    # The example below runs on the 5th day of the month at 10:00 UTC.
    - cron: '0 10 5 * *' 
  
  # Also allow manual trigger
  workflow_dispatch:

jobs:
  collect_and_commit:
    runs-on: ubuntu-latest
    
    # Set environment variable for API Key
    env:
      # Securely store your BLS API key in GitHub Secrets
      BLS_API_KEY: ${{ secrets.BLS_API_KEY }}

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # Crucial: Need to check out the repo with a token that has write permission
        token: ${{ secrets.GITHUB_TOKEN }} 
        
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x' 
        
    - name: Install dependencies
      run: pip install -r requirements.txt
      
    - name: Create data directory
      run: mkdir -p data
      
    - name: Run data collection script
      run: python collect_data.py
      
    - name: Commit and Push new data
      # Use a dedicated action for commiting changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: 'ðŸ¤– BLS Data Update: New Monthly Data Collected'
        # Only commit the updated CSV file
        file_pattern: 'data/bls_data.csv'
        # Required for the commit to show up as a workflow bot
        commit_user_name: 'github-actions[bot]'
        commit_user_email: 'github-actions[bot]@users.noreply.github.com'
